
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>rigging_and_skeletal_animation_in_three.js - 微个日光日</title>
	<meta name="author" content="Nicholas">

	
	<meta name="description" content="rigging_and_skeletal_animation_in_three.js JavaScript
and stuff
github.com/roman01la
Rigging and skeletal animation in Three.js
Update: Do not move/ &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="微个日光日" type="application/atom+xml">
	
	<link rel="canonical" href="http://xiebaochun.github.io/blog/2014/07/01/rigging-and-skeletal-animation-in-three-dot-js/">
	<link href="/public/favicon.png" rel="shortcut icon">
	<link href="/public/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/public/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<!-- <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'> -->
	<script src="/public/javascripts/jquery-1.7.2.min.js"></script>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!-- <link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"> -->

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript"
   src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
</head>


<body>

    
<link href="/public/stylesheets/topheader.css" media="screen, projection" rel="stylesheet" type="text/css">
<div id="topheader">
       <div class="info_wrap wrap">
           <div class="info_show">
                <i class="fl s_line"></i>
                <ul class="my_btn fl">
                    <li class="uname">
                        <p>欢迎光临小站！</p>
                    </li>
                    <li class="fl s_line"></li>
                </ul>
                <ul class="friends">
                    <li class="">
                        <a href="#s1">友联</a>
                         <ul class="submenu">
                            <li><a href="http://ued.taobao.org/blog/" target="_blank">淘宝UED</a></li>
                            <li><a href="http://www.blueidea.com/" target="_blank">蓝色理想</a></li>
                            <li><a href="http://ux.etao.com/" target="_blank">一淘UED</a></li>
                            <li><a href="http://cdc.tencent.com/" target="_blank">腾讯CDC</a></li>
                            <li><a href="http://ecd.tencent.com/" target="_blank">腾讯ECD</a></li>
                            <li><a href="http://www.ucdchina.com/" target="_blank">UCDChina</a></li>
                            <li><a href="http://www.chinavisual.com/" target="_blank">视觉中国</a></li>
                            <li><a href="http://www.uirss.com/" target="_blank">UIRSS</a></li>
                        </ul>  
                    </li>
                     
                </ul>
                
           </div>

       </div>
       <div class="logo_info_wrap">
            <div class="logo_show wrap">
                <div class="logo_wrap fl">
                    <a href="http://www.juerry.com" class="logo" title="首页">首页</a>
                </div>
            </div>
       </div>
       <div id="navigation" class="wrap clearfix">
            <div class="nav_item_wrap">
                <ul class="nav_list clearfix">
                    <li class="nav_item">
                        <a id="nav_home" href="http://xiebaochun.github.io/index.html">首页</a>
                    </li>
                    <li class="nav_item category_shopping">
                        <a href="">HTML前端</a>
                    </li>
                    <li class="nav_item category_second">
                        <a href="" >CSS3</a>
                    </li>
                    <li class="nav_item category_second">
                        <a href="" >游戏</a>
                    </li>
                    <li class="nav_item category_second">
                        <a href="" >应用</a>
                    </li>
                    <li class="nav_item category_second category_second_last">
                        <a href="">插件</a>
                    </li>
                    <li class="nav_item">
                        <a href="" >自习室</a>
                    </li>
                    <li class="nav_item">
                        <a href="http://xiebaochun.github.io/mylab/index.html" >实验室</a>
                    </li> 
                    <li class="nav_item nav_item_tuan nav_item_fix posi_rale">
                        <a id="textile" href="http://xiebaochun.github.io/textile.html">设计室</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    </li>
                    <!--<li class="nav_item nav_item_shop nav_item_fix posi_rale">
                        <a href="" target="_blank"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

                    </li>-->
                    <li class="nav_item last ">
                        <a class="c" id="nav_resume" href="http://xiebaochun.github.io/public/index.html">博客</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

	<div style="min-width:100px;"class="container wrap">
         
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><!--the weather pugin-->
       <!-- <script defer src="http://julying.com/lab/weather/v3/jquery.weather.build.min.js?parentbox=body&moveArea=all&zIndex=2&move=1&drag=1&autoDrop=1&styleSize=big&style=_random&area=client&city=%E5%8C%97%E4%BA%AC"></script> -->
<div class="profilepic">
	<!-- <img style="width: 160px;" src="https://avatars1.githubusercontent.com/u/2996519?s=460"/> -->
	<script src="/public/javascripts/md5.js"></script>
	<script type="text/javascript">
		$(function(){
			// $('.profilepic').append("<img src='http://mt1.baidu.com/timg?wh_rate=0&wapiknow&quality=100&size=w250&sec=0&di=309920a4e4cd155969da5e7aa66485d3&src=http%3A%2F%2Fimg.iknow.bdimg.com%2Fjctuijian%2F0626%2F6.jpg' alt='Profile Picture' style='width: 160px;' />");
		});
	</script>
</div>
<!-- <hgroup>
  <h1><a href="/public/">微个日光日</a></h1>
  
    <h2>one blog for share.</h2>
  
</hgroup>
 -->
<nav id="main-nav"><ul class="main-navigation">
  <!-- <li><a href="http://xiebaochun.github.io">Home</a></li>
  <li><a href="/public/blog/archives">Archives</a></li> -->
  <!-- <li><a href="http://www.juerry.com/index.html">my lab</a></li> -->
</ul>

</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/xiebaochun" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/xiebaochun" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
<section>
  <!-- <h1>Categories</h1> -->
  <h1>分类</h1>
    <ul id="category-list"><li><a href='/blog/categories/ios/'>ios (2)</a></li><li><a href='/blog/categories/other/'>other (13)</a></li><li><a href='/blog/categories/three-dot-js/'>three.js (1)</a></li><li><a href='/blog/categories/web/'>web (26)</a></li></ul>
    <script type="text/javascript"> 
           $("#category-list li").each(function()
           {
                $(this).children().attr("href","/public"+$(this).children().attr("href"));
              
           });
    </script>
</section>

</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">rigging_and_skeletal_animation_in_three.js</h1>
	<div class="entry-content" itemprop="articleBody"><p>JavaScript
and stuff
github.com/roman01la
Rigging and skeletal animation in Three.js
Update: Do not move/rotate the armature, this will cause geometry stretching. Align the first bone using its tail/head position
Three.js supports some basic rigging and skeletal animation. The simplest way to achieve a nice character animation is to make it in appropriate software first. This article is going to be about Blender rigging workflow and how to do the best for a clean Three.js export.
Here’s a very nice and detailed article about rigging and animating in Blender with further exporting and scene setup in Three.js. Actually I got this thing after reading the article. Here’s my, actually same, workflow, but with some tips and additions.
That’s what we’ll get when all thing will be done.</p>

<p>Lets create a simple shape. You’ll need Blender itself and exporter script, check the article about external models to find out.
Create a mesh
Remove camera and light from the scene and extrude the box. Select it with RMB, go into Edit mode with Tab, hit A to unselect the object, hit Ctrl+Tab and select Face select mode. Select one face with RMB, hit E, hold Ctrl and drag the mouse to extrude the face. Drag it until you get another cube in same size. Click LMB and release Ctrl key. Do the process for one more time to make another cube.</p>

<p>Create an armature
Now, add an armature. Hit Z to go to Wireframe view mode. Hit Shift+A, select Armature -&gt; Single Bone, this will add a bone. Rotate and position the bone as shown below. Position the bone using its tail/head position. Select armature, go to Edit mode, select bone, hit E, hold Ctrl and drag to create a new bone. Create another two bones, so you’ll get four bones armature.</p>

<p>Create and assign vertex groups
So here we have a mesh and an armature, the next step is to assign the geometry to the appropriate bones. It can be done in two ways: automatic assignment and manual. I prefer manual, you can choose assignment polygons more precisely.
Each set of polys is called a vertex group, and the name of the group should be exact same like the name of the bone we want assign to. Usually, in Blender, the first bone name is Bone, the second one is Bone.001, the next is Bone.002 and so on.
Select the mesh and go to Edit mode. Go to Object Data tab in the Properties panel. Hit + under the Vertex Groups list to add a new group, call it Bone.001, this is the second bone of the armature. Choose Face select mode and select all five faces of the first cube with Shift+RMB. Once you’ve done make sure that the right vertex group is chosen, hit Assign button under Vertex Groups. Now the first cube geometry will be transformed with its bone. You can check the assignment by selecting a vertex group and hit Select button, if there are extra faces, select only them and hit Remove button. Repeat the process for the rest of the mesh.
Tip: For more complex geometry to create nearby vertex groups and make sure that there are no same faces assigned to both, create the first vertex group, select it in the list, hit select to select its faces, select all faces of the second vertex group which are the nearest to first group faces, make sure the first vertex group is selected, hit Deselect and you’ll get edge selection which is a boundary between two groups. Now you create the second vertex group based on that line.
Tip: When the armature is about to have a static geometry, read further about it, it also must be assigned to its bone, otherwise it won’t be visible. So, we need to select all the faces that are not belong to any other vertex groups. The trick here is to select all groups (choose group in the list and hit Select) and then hit Ctrl+I which states for Inverse Selection, selected faces can be assigned to static vertex group.</p>

<p>There’s one more action required to finish with assignment. We need to parent the mesh to the armature. Go to Object mode, select mesh, go to Object tab in the Properties panel and hit Parent box under relations section, select Armature object. Hit the box below and select Armature from the list. If the mesh has changed its position, align it back to the bones.
Animate the armature
The armature is ready for animation. Make sure the mark is in the first frame position on the timeline. Select the armature and go to Pose mode (Ctrl+Tab), select the bone, hit I to add a keyframe and choose LocRotScale. Move the mark to frame 10 and move the bone, add another keyframe. Do it with all bones and play with position and time, except the first one. The first bone is the support bone and it should be static. Do not change its position, just add a keyframe in the first frame. This is useful when you are doing a hand animation, for example, where only fingers are moving and the hand itself should be static. Select the last keyframe of the animation and hit E to set the end of the anim. Three.js will play the animation from the first to the last defined keyframes. That means if you have a gap before the first keyframe, it won’t be played. Just add another keyframe in the first frame position to make that gap playable in Three.js.</p>

<p>In the article I’ve mentioned at the beginning there’s a section about removing unused actions of the animation, to make sure Three.js will play the right one. This is a good point, but is not required if you are making all stuff carefully. But still, read about it.
Export the model
If everything is ok and you are happy with your skeleton and anim, it’s time to export things. Make sure you have installed exporter script. Select both mesh and armature. Go to File -&gt; Export -&gt; Three.js. Enable the next options in the Export Three.js section: skinning, bones and skeletal animation. Export the model.
Setup Three.js scene
Use a scene setup from one of the previous articles, adjust light and camera position.
We need a loader to load the model, create SkinnedMesh instance using model geometry and materials and enable skinning on its materials.
var loader = new THREE.JSONLoader();
var animation;</p>

<p>// load the model and create everything
loader.load(‘model.js’, function (geometry, materials) {
  var mesh, material;</p>

<p>// create a mesh
  mesh = new THREE.SkinnedMesh(
    geometry,
    new THREE.MeshFaceMaterial(materials)
  );</p>

<p>// define materials collection
  material = mesh.material.materials;</p>

<p>// enable skinning
  for (var i = 0; i &lt; materials.length; i++) {
    var mat = materials[i];</p>

<pre><code>mat.skinning = true;   }
</code></pre>

<p>scene.add(mesh);</p>

<p>// add animation data to the animation handler
  THREE.AnimationHandler.add(mesh.geometry.animation);</p>

<p>// create animation
  animation = new THREE.Animation(
    mesh,
    ‘ArmatureAction’,
    THREE.AnimationHandler.CATMULLROM
  );</p>

<p>// play the anim
  animation.play();</p>

<p>render();
});</p>

<p>function render() {
  animation.update(.01);
  renderer.render(scene, camera);
  requestAnimationFrame(render);
}
9 months ago
#webgl  #threejs  #blender  #rigging  #skeletal animation
8 notes</p>

<p>mashabatsea likes this</p>

<p>jhclaura likes this</p>

<p>laugharne-me reblogged this from roman01la</p>

<p>recto-ver-so likes this</p>

<p>oivoodoo likes this</p>

<p>paraknight likes this</p>

<p>prostheticknowledge likes this</p>

<p>datahacker likes this</p>

<p>roman01la posted this
Ashley theme by Jxnblk</p>
</div>

</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
	
	<!-- JiaThis Button BEGIN -->
<div class="jiathis_style_32x32">
	<a class="jiathis_button_qzone"></a>
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_tqq"></a>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_renren"></a>
	<a href="http://www.jiathis.com/share?uid=1838235" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript">
var jiathis_config = {data_track_clickback:'true'};
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1371541356556113" charset="utf-8"></script>
<!-- JiaThis Button END -->
<!-- UY BEGIN -->
<div id="uyan_frame"></div>
<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=1838235"></script>
<!-- UY END -->
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2014 - Nicholas -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>
<!-- Baidu Button BEGIN -->
   <script type="text/javascript" id="bdshare_js" data="type=slide&amp;img=1&amp;pos=right&amp;uid=0" src="http://bdimg.share.baidu.com/static/js/bds_s_v2.js?cdnversion=389859"></script>
   <script type="text/javascript">
        var bds_config={"bdTop":300};
        document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + Math.ceil(new Date()/3600000);
   </script>
        <!-- Baidu Button END -->
Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			


<!-- 




  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>

 -->



		</div>
	</div>
</body>
</html>
